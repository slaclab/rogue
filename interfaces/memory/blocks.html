

<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Blocks &amp; Models &mdash; Rogue v6.4.4 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js?v=7151e8f0"></script>
      <script src="../../_static/doctools.js?v=888ff710"></script>
      <script src="../../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Advanced Usage Of Blocks" href="blocks_advanced.html" />
    <link rel="prev" title="Using The TCP Bridge" href="usingTcp.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Rogue
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../installing/index.html">Installing &amp; Compiling Rogue</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pyrogue_tree/index.html">PyRogue Tree</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Interfaces</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../clients/index.html">Client Interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stream/index.html">Stream Interface</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Memory Interface</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="connecting.html">Connecting Memory Elements</a></li>
<li class="toctree-l3"><a class="reference internal" href="master.html">Memory Master Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="slave.html">Memory Slave Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="hub.html">Memory Hub Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="usingTcp.html">Using The TCP Bridge</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Blocks &amp; Models</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#custom-models">Custom Models</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-custom-models">Using Custom Models</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pre-allocating-blocks">Pre-Allocating Blocks</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="blocks_advanced.html">Advanced Usage Of Blocks</a></li>
<li class="toctree-l3"><a class="reference internal" href="classes/index.html">Memory Interface Class Descriptions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../simulation/index.html">Simulation Interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sql.html">SQL Logging Interface</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../utilities/index.html">Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hardware/index.html">Hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../protocols/index.html">Protocols</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../logging/index.html">Logging In Rogue</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../custom_module/index.html">Creating Custom Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pydm/index.html">Using the PyDM Gui</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../migration/index.html">Migration Notes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Rogue</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Interfaces</a></li>
          <li class="breadcrumb-item"><a href="index.html">Memory Interface</a></li>
      <li class="breadcrumb-item active">Blocks &amp; Models</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/interfaces/memory/blocks.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="blocks-models">
<span id="interfaces-memory-blocks"></span><h1>Blocks &amp; Models<a class="headerlink" href="#blocks-models" title="Permalink to this heading"></a></h1>
<p>In the Rogue memory interface, the block provides a representation of the underlying hardware memory
space, hosting one or more Variable objects. It is in the Block where native python types are converted
into the bits and byte that are ultimately written to the hardware devices.</p>
<p>When Variables are created in a Device they are arranged into Blocks which may host multiple variables. The
mapping of Variables to Blocks is determined by the minimum register transaction size supported by the
hardware. For example if the hardware requires a minimum transaction size of 32-bits, a set of Variables
which access space in a single 32-bit register will be mapped to the same Block. The user may also
pre-build blocks in Device with a specific size in order to enforece a larger grouping of Variables into
a Block.</p>
<p>The Block object will keep track of the “stale” state of the shadow memory space. This allows the various
Variables in a Block to be updated, followed by a single transaction that commits the Block memory space
to hardware. For very large Blocks which are much larger than the minimum transaction size, the user may
initiate sub-block transactions which only update the “stale” portion of the Block space. This allows the
user to perform high rate, low overhead transactions to individual sections of a Block while also supporting
larger burst transactions when the entire Block is read from or written to memory.</p>
<p>In most cases the user will simply add Variables to a Device with little attention to how the Blocks are
created and assigned to Variables. In some cases the user may want to set the size of specific
Blocks for performance reasons. In more advanced cases the user can also sub-class a Block, creating
a custom device which allows new types of transactions, and also allows lower level complex register
transactions to occur at a lower level in the Block.</p>
<p>See <a class="reference internal" href="blocks_advanced.html#interfaces-memory-blocks-advanced"><span class="std std-ref">Advanced Usage Of Blocks</span></a> for more information about the advanced features of the Block class.</p>
<p>The translation of native python types to lower level bits and bytes is controlled by the Model class, which is
a special Python class in Rogue which defines how a register type is converted, accessed and displayed. The Model
class works closely with the Block, with the Block having lower level routines which are directly associated
with the standard set of Rogue Models.</p>
<p>The following Models are currently supported in Rogue:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Model</p></th>
<th class="head"><p>Hardware Type</p></th>
<th class="head"><p>Python Type</p></th>
<th class="head"><p>Bit Size</p></th>
<th class="head"><p>Notes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference internal" href="classes/model.html#interfaces-memory-model-uint"><span class="std std-ref">UInt</span></a></p></td>
<td><p>unsigned integer</p></td>
<td><p>int</p></td>
<td><p>unconstrained</p></td>
<td><p>Little endian</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="classes/model.html#interfaces-memory-model-uintbe"><span class="std std-ref">UIntBE</span></a></p></td>
<td><p>unsigned integer</p></td>
<td><p>int</p></td>
<td><p>unconstrained</p></td>
<td><p>Same as UInt but big endian</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="classes/model.html#interfaces-memory-model-uintreversed"><span class="std std-ref">UIntReversed</span></a></p></td>
<td><p>unsigned integer</p></td>
<td><p>int</p></td>
<td><p>unconstrained</p></td>
<td><p>Same as UInt but with a reversed bit order.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="classes/model.html#interfaces-memory-model-int"><span class="std std-ref">Int</span></a></p></td>
<td><p>signed integer</p></td>
<td><p>int</p></td>
<td><p>unconstrained</p></td>
<td><p>Little endian</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="classes/model.html#interfaces-memory-model-intbe"><span class="std std-ref">IntBE</span></a></p></td>
<td><p>signed integer</p></td>
<td><p>int</p></td>
<td><p>unconstrained</p></td>
<td><p>Same as Int but big endian</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="classes/model.html#interfaces-memory-model-bool"><span class="std std-ref">Bool</span></a></p></td>
<td><p>bit</p></td>
<td><p>bool</p></td>
<td><p>1-bit</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="classes/model.html#interfaces-memory-model-string"><span class="std std-ref">String</span></a></p></td>
<td><p>bytes</p></td>
<td><p>string</p></td>
<td><p>unconstrained</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="classes/model.html#interfaces-memory-model-float"><span class="std std-ref">Float</span></a></p></td>
<td><p>32-bit float</p></td>
<td><p>float</p></td>
<td><p>32-bits</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="classes/model.html#interfaces-memory-model-floatbe"><span class="std std-ref">FloatBE</span></a></p></td>
<td><p>32-bit float</p></td>
<td><p>float</p></td>
<td><p>32-bits</p></td>
<td><p>Same as float but big endian</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="classes/model.html#interfaces-memory-model-double"><span class="std std-ref">Double</span></a></p></td>
<td><p>64-bit float</p></td>
<td><p>float</p></td>
<td><p>64-bits</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="classes/model.html#interfaces-memory-model-doublebe"><span class="std std-ref">DoubleBE</span></a></p></td>
<td><p>64-bit float</p></td>
<td><p>float</p></td>
<td><p>64-bits</p></td>
<td><p>Same as float but big endian</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="classes/model.html#interfaces-memory-model-fixed"><span class="std std-ref">Fixed</span></a></p></td>
<td><p>fixed point</p></td>
<td><p>float</p></td>
<td><p>unconstrained</p></td>
<td><p>Not fully functional yet</p></td>
</tr>
</tbody>
</table>
<p>Most of the above types perform the python to byte conversions in low level C++ calls in the Block class for performance reasons.
An exception to this is UInt and Int types that exceed 64-bits. These conversions are performed in the Model class at the python
level.</p>
<section id="custom-models">
<h2>Custom Models<a class="headerlink" href="#custom-models" title="Permalink to this heading"></a></h2>
<p>The user has the ability to create application specific data types by sub-classing the Model in python and providing the
toByte and fromBytes functions that are called by the Block to perform the data conversions. This allows for a quick method to
support odd data types.</p>
<p>The block class also supports any of the above Models as a list. See the Variable class description for more details.</p>
<p>Below is an example of a user defined Model for a special data type:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pyrogue</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">rogue.interfaces.memory</span>

<span class="c1"># Create a sub-class of a model</span>
<span class="k">class</span><span class="w"> </span><span class="nc">MyUInt</span><span class="p">(</span><span class="n">pyrogue</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>

    <span class="c1"># Setup the class parameters</span>
    <span class="n">ptype</span> <span class="o">=</span> <span class="nb">int</span>
    <span class="n">defaultdisp</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:#x}</span><span class="s1">&#39;</span>
    <span class="n">modelId</span> <span class="o">=</span> <span class="n">rogue</span><span class="o">.</span><span class="n">interfaces</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">PyFunc</span>

   <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bitsize</span><span class="p">):</span>
     <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">bitsize</span><span class="p">)</span>

   <span class="c1"># This function receives the native python type and converts it to a byte array</span>
   <span class="k">def</span><span class="w"> </span><span class="nf">toBytes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
       <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="n">byteCount</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bitSize</span><span class="p">),</span> <span class="s1">&#39;little&#39;</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

   <span class="c1"># This function receives a byte array and converts it to the native python type</span>
   <span class="k">def</span><span class="w"> </span><span class="nf">fromBytes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ba</span><span class="p">):</span>
       <span class="k">return</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">ba</span><span class="p">,</span> <span class="s1">&#39;little&#39;</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

   <span class="c1"># Convert a string representation to the python native type</span>
   <span class="k">def</span><span class="w"> </span><span class="nf">fromString</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
       <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

   <span class="c1"># Return the minimum value</span>
   <span class="k">def</span><span class="w"> </span><span class="nf">minValue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
       <span class="k">return</span> <span class="mi">0</span>

   <span class="c1"># Return the maximum value</span>
   <span class="k">def</span><span class="w"> </span><span class="nf">maxValue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
       <span class="k">return</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">32</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
</pre></div>
</div>
<p>The user may also want to perform the python type conversion in lower level C++. In order to do this they
must sub-class the Block class and add it to a user specific library. They can then use a modeId in the
range 0x80 - 0xFF.  See <a class="reference internal" href="blocks_advanced.html#interfaces-memory-blocks-advanced"><span class="std std-ref">Advanced Usage Of Blocks</span></a> for more information about the advanced features of the Block class.</p>
</section>
<section id="using-custom-models">
<h2>Using Custom Models<a class="headerlink" href="#using-custom-models" title="Permalink to this heading"></a></h2>
<p>The following shows an example of using the above custom model in Rogue. The code blow is executed during the
creation of a custom Device class. See xxxx for more details.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a variable using my custom Model</span>
<span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pyrogue</span><span class="o">.</span><span class="n">RemoteVariable</span><span class="p">(</span>
   <span class="n">name</span><span class="o">=</span><span class="s2">&quot;MyRegister&quot;</span><span class="p">,</span>
   <span class="n">description</span><span class="o">=</span><span class="s2">&quot;My register with my model&quot;</span><span class="p">,</span>
   <span class="n">offset</span><span class="o">=</span><span class="mh">0x1000</span><span class="p">,</span>
   <span class="n">bitSize</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span>
   <span class="n">bitOffset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
   <span class="n">base</span><span class="o">=</span><span class="n">MyUInt</span><span class="p">,</span>
   <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;RW&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>The custom model is passed to the RemoteVariable base parameter. A Block of the appropriate size will be created
and assocaited with the above RemoteVariable as approprite.</p>
</section>
<section id="pre-allocating-blocks">
<h2>Pre-Allocating Blocks<a class="headerlink" href="#pre-allocating-blocks" title="Permalink to this heading"></a></h2>
<p>In some cases the user may want to pre-create blocks of a specific size to better group Variables that are more
effeciently accessed in larger burst transactions. With larger blocks the user can initiate transactions
on a sub-portion of the block by accessing the variable directly, or the user can force larger burst transactions
of the larger block in operations which require it.</p>
<p>The following shows an example of pre-allocating a block for association with a Variable. The Variables are assigned to
blocks the overlap their address space. The code blow is executed during the creation of a custom Device class. See xxxx for more details.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Pre-Allocate a large block to hold our variables, offset = 0x1000, size = 128</span>
<span class="bp">self</span><span class="o">.</span><span class="n">addCustomBlock</span><span class="p">(</span><span class="n">rogue</span><span class="o">.</span><span class="n">interfaces</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">Block</span><span class="p">(</span><span class="mh">0x1000</span><span class="p">,</span><span class="mi">128</span><span class="p">))</span>

<span class="c1"># Create a variable using my custom Model</span>
<span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pyrogue</span><span class="o">.</span><span class="n">RemoteVariable</span><span class="p">(</span>
   <span class="n">name</span><span class="o">=</span><span class="s2">&quot;MyRegister&quot;</span><span class="p">,</span>
   <span class="n">description</span><span class="o">=</span><span class="s2">&quot;My register with my model&quot;</span><span class="p">,</span>
   <span class="n">offset</span><span class="o">=</span><span class="mh">0x1000</span><span class="p">,</span>
   <span class="n">bitSize</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span>
   <span class="n">bitOffset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
   <span class="n">base</span><span class="o">=</span><span class="n">MyUInt</span><span class="p">,</span>
   <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;RW&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>For more information see the <a class="reference internal" href="classes/block.html#interfaces-memory-block"><span class="std std-ref">Block</span></a> and <a class="reference internal" href="classes/model.html#interfaces-memory-model"><span class="std std-ref">Model</span></a> class descriptions.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="usingTcp.html" class="btn btn-neutral float-left" title="Using The TCP Bridge" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="blocks_advanced.html" class="btn btn-neutral float-right" title="Advanced Usage Of Blocks" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, SLAC National Accelerator Laboratory.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>