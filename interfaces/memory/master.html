

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Memory Master Example &mdash; Rogue v6.6.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=16afd591"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Memory Slave Example" href="slave.html" />
    <link rel="prev" title="Connecting Memory Elements" href="connecting.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Rogue
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../installing/index.html">Installing &amp; Compiling Rogue</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pyrogue_tree/index.html">PyRogue Tree</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Interfaces</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../clients/index.html">Client Interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stream/index.html">Stream Interface</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Memory Interface</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="connecting.html">Connecting Memory Elements</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Memory Master Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="slave.html">Memory Slave Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="hub.html">Memory Hub Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="usingTcp.html">Using The TCP Bridge</a></li>
<li class="toctree-l3"><a class="reference internal" href="blocks.html">Blocks &amp; Models</a></li>
<li class="toctree-l3"><a class="reference internal" href="blocks_advanced.html">Advanced Usage Of Blocks</a></li>
<li class="toctree-l3"><a class="reference internal" href="classes/index.html">Memory Interface Class Descriptions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../simulation/index.html">Simulation Interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sql.html">SQL Logging Interface</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../utilities/index.html">Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hardware/index.html">Hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../protocols/index.html">Protocols</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../logging/index.html">Logging In Rogue</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../custom_module/index.html">Creating Custom Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pydm/index.html">Using the PyDM Gui</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../migration/index.html">Migration Notes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Rogue</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Interfaces</a></li>
          <li class="breadcrumb-item"><a href="index.html">Memory Interface</a></li>
      <li class="breadcrumb-item active">Memory Master Example</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/interfaces/memory/master.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="memory-master-example">
<span id="interfaces-memory-master-ex"></span><h1>Memory Master Example<a class="headerlink" href="#memory-master-example" title="Link to this heading">ÔÉÅ</a></h1>
<p>In most cases the user will take advantage of the pyrogue.RemoteVariable,
pyrogue.Device, pyrogue.RemoteCommand and pyrogue.MemoryBlock classes to
interact with memory buses. In rare cases it may be necessary to write
custom memory Master modules in Python or C++.</p>
<p>Python and C++ subclasses of the Master class can be used interchangeably,
allowing c++ Slave subclasses to service memory transactions from python
masters and python Slave subclasses to receive service memory transactions
initiated by c++ masters.</p>
<p>See <a class="reference internal" href="classes/master.html#interfaces-memory-master"><span class="std std-ref">Master</span></a> for more detail on the Master class.</p>
<p>Below is an example class which will initiate a read followed by a write.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pyrogue</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">rogue.interfaces.memory</span>

<span class="c1"># Create a subclass of a memory Master</span>
<span class="c1"># This master will initiate a read from a passed address and</span>
<span class="c1"># increment that value at that address by a passed value</span>
<span class="k">class</span><span class="w"> </span><span class="nc">MyMemMaster</span><span class="p">(</span><span class="n">rogue</span><span class="o">.</span><span class="n">interfaces</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">Master</span><span class="p">):</span>

    <span class="c1"># Init method must call the parent class init</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

    <span class="c1"># Start a sequence with passed address and increment value</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">incAtAddress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>

        <span class="c1"># Create byte array for data</span>
        <span class="n">ba</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>

        <span class="c1"># Clear any existing errors</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_clearError</span><span class="p">()</span>

        <span class="c1"># Start read transaction from address into bytearray</span>
        <span class="c1"># size = 4, byte array offset = 0</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reqTransaction</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">ba</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">rogue</span><span class="o">.</span><span class="n">interfaces</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">Read</span><span class="p">)</span>

        <span class="c1"># Wait for transaction to complete</span>
        <span class="n">_waitTransaction</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>

        <span class="c1"># Check transaction result</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getError</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;got error&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Increment value in byte array by passed value</span>
        <span class="n">oldValue</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">ba</span><span class="p">,</span> <span class="s1">&#39;little&#39;</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">oldvalue</span> <span class="o">+=</span> <span class="n">value</span>
        <span class="n">ba</span> <span class="o">=</span> <span class="n">oldValue</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;little&#39;</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Start write transaction to address from bytearray</span>
        <span class="c1"># size = 4, byte array offset = 0</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reqTransaction</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">ba</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">rogue</span><span class="o">.</span><span class="n">interfaces</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">Write</span><span class="p">)</span>

        <span class="c1"># Wait for transaction to complete</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_waitTransaction</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>

        <span class="c1"># Check transaction result</span>
        <span class="bp">self</span><span class="o">.</span><span class="k">if</span> <span class="n">_getError</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;got error&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
</pre></div>
</div>
<p>The equivalent code in C++ is show below:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;rogue/interfaces/memory/Constants.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;rogue/interfaces/memory/Master.h&gt;</span>

<span class="c1">// Create a subclass of a memory Master</span>
<span class="c1">// This master will initiate a read from a passed address and</span>
<span class="c1">// increment that value at that address by a passed value</span>
<span class="n">class</span><span class="w"> </span><span class="n">MyMemMaster</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">public</span><span class="w"> </span><span class="n">rogue</span><span class="o">::</span><span class="n">interfaces</span><span class="o">::</span><span class="n">memory</span><span class="o">::</span><span class="n">Master</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="n">public</span><span class="o">:</span>

<span class="w">      </span><span class="c1">// Create a static class creator to return our custom class</span>
<span class="w">      </span><span class="c1">// wrapped with a shared pointer</span>
<span class="w">      </span><span class="k">static</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">MyMemMaster</span><span class="o">&gt;</span><span class="w"> </span><span class="n">create</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">static</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">MyMemMaster</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span>
<span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">MyMemMaster</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">         </span><span class="k">return</span><span class="p">(</span><span class="n">ret</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>

<span class="w">      </span><span class="c1">// Standard class creator which is called by create</span>
<span class="w">      </span><span class="n">MyMemMaster</span><span class="p">()</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">rogue</span><span class="o">::</span><span class="n">interfaces</span><span class="o">::</span><span class="n">memory</span><span class="o">::</span><span class="n">Master</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span>

<span class="w">      </span><span class="c1">// Start a sequence with passed address and increment value</span>
<span class="w">      </span><span class="kt">bool</span><span class="w"> </span><span class="n">incAtAddress</span><span class="p">(</span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">address</span><span class="p">,</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">rValue</span><span class="p">;</span>
<span class="w">         </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>

<span class="w">         </span><span class="c1">// Clear any existing errors</span>
<span class="w">         </span><span class="n">this</span><span class="o">-&gt;</span><span class="n">clearError</span><span class="p">();</span>

<span class="w">         </span><span class="c1">// Start read transaction, size=4</span>
<span class="w">         </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="o">-&gt;</span><span class="n">reqTransaction</span><span class="p">(</span><span class="n">address</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">rValue</span><span class="p">,</span><span class="w"> </span><span class="n">rogue</span><span class="o">::</span><span class="n">interfaces</span><span class="o">::</span><span class="n">memory</span><span class="o">::</span><span class="n">Read</span><span class="p">);</span>

<span class="w">         </span><span class="c1">// Wait for transaction to complete</span>
<span class="w">         </span><span class="n">this</span><span class="o">-&gt;</span><span class="n">waitTransaction</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>

<span class="w">         </span><span class="c1">// Check transaction result</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">this</span><span class="o">-&gt;</span><span class="n">getError</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">             </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;got error</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">             </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>

<span class="w">         </span><span class="c1">// Increment value by passed value</span>
<span class="w">         </span><span class="n">rValue</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>

<span class="w">         </span><span class="c1">// Start write transaction, size = 4</span>
<span class="w">         </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="o">-&gt;</span><span class="n">reqTransaction</span><span class="p">(</span><span class="n">address</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">rValue</span><span class="p">,</span><span class="w"> </span><span class="n">rogue</span><span class="o">::</span><span class="n">interfaces</span><span class="o">::</span><span class="n">memory</span><span class="o">::</span><span class="n">Write</span><span class="p">);</span>

<span class="w">         </span><span class="c1">// Wait for transaction to complete</span>
<span class="w">         </span><span class="n">this</span><span class="o">-&gt;</span><span class="n">waitTransaction</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>

<span class="w">         </span><span class="c1">// Check transaction result</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">this</span><span class="o">-&gt;</span><span class="n">getError</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">             </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;got error</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">             </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>

<span class="w">      </span><span class="p">}</span>
<span class="p">};</span>

<span class="c1">// Shared pointer alias</span>
<span class="k">typedef</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">MyMemMaster</span><span class="o">&gt;</span><span class="w"> </span><span class="n">MyMemMasterPtr</span><span class="p">;</span>
</pre></div>
</div>
<p>Of course neither of the above classes ensure that the memory does not get modified by
another process between the read and write. The pyrogue device management tree manages
this at a higher level.</p>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="connecting.html" class="btn btn-neutral float-left" title="Connecting Memory Elements" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="slave.html" class="btn btn-neutral float-right" title="Memory Slave Example" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, SLAC National Accelerator Laboratory.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>